<script type="text/javascript">
    $(document).ready(function() {
        $('#upgrade').click(function() {
            $('#upgrade').html('<img src="/img/load.gif">');
            $.ajax({
                type: "POST",
                url: "/update/do_upgrade",
                data: '',
                success: function(data) {
                    $('#upgrade').html('Upgrade');
                    if (data == '')
                        data = 'Updating, please wait for the device to reboot.';
                    alert(data);
                },
            });
        }); 
    });
    
    <?php if ???? && $this->_params['download_status'] != '100'): ?>

    updateDownloadStatus();
    function updateDownloadStatus() {
      $.ajax({
        type: "GET",
        url: "/admin/download_status",
        success: function(data) {
            $('#progressbar').css('width', data+'%');
            if (data=='100') {
                $("#UpdateStatus").html('<h3>Download complete, applying update:</h3>');
                // $("#torTile").addClass("connected");
            }
        }    
      });
    }    
    setInterval(function() {
      updateDownloadStatus();
    }, 2000);

    
    <?php if ???? && $this->_params['download_status'] == '100'): ?>
    iProgress = 0 
    $('#progressbar').css('width', iProgress + '%');
    
    updateUpdateStatus();
    function updateUpdateStatus() {
        iProgress = iProgress +2; 
        $('#progressbar').css('width', data+'%');
            if (iProgress > '100') {
                $("#UpdateStatus").html('<h3>Update Applied. Reload Page!</h3>');
                // $("#torTile").addClass("connected");
            }
        }    
      });
    }    
    setInterval(function() {
      updateUpdateStatus();
    }, 2000);

    
    
<?php endif; ?>
</script>

       <div class="row">
            <div class="col-xs-12 col-md-6">
                  <img src="/img/logo/logo-nak-square.png">
                  <h3>Update Required</h3>
                  <p>A newer version of the software is available, please upgrade.</p>
                  <p style="font-weight: bold">Warning: DO NOT turn off or disconnect the device during the upgrade process.</p>
                  <form id="upgrade-form" action="/update/do_upgrade" method="POST">
                      <a id="upgrade" type="button" class="btn btn-primary">Upgrade</a>
                  </form>
                  <div id="UpdateStatus">
                        <?php if ($this->_params['download_status'] == '100'): ?>
                        <h3>Download complete, applying update:</h3>
                        <?php else: ?>
                        <h3>Downloading update:</h3>
                        <?php endif; ?>
                  </div>
                  <div class="progress">
                    <div id="progressbar" class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: <?= $this->_params['progress_status']?>%">
                        <span class="sr-only">10% Complete (success)</span>
                    </div>
                  </div>
            </div>
      </div>   
